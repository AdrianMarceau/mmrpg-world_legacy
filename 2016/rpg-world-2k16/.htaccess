# Define the cache manifest settings
<IfModule mod_expires.c>
ExpiresActive on
ExpiresByType text/cache-manifest "access plus 0 seconds"
ExpiresByType image/gif "access plus 1 months"
ExpiresByType image/jpg "access plus 1 months"
ExpiresByType image/jpeg "access plus 1 months"
ExpiresByType image/png "access plus 1 months"
ExpiresByType audio/mpeg "access plus 1 months"
ExpiresByType audio/mp3 "access plus 1 months"
ExpiresByType audio/ogg "access plus 1 months"
ExpiresByType application/ogg "access plus 1 months"
ExpiresByType text/javascript "access plus 1 months"
ExpiresByType text/css "access plus 1 months"
</IfModule>

# Increase memory limit
#php_value memory_limit 128M

# Turn on GZIPPING if enabled
<ifModule mod_gzip.c>
  mod_gzip_on Yes
  mod_gzip_dechunk Yes
  mod_gzip_item_include file \.(html?|txt|css|js|php|pl)$
  mod_gzip_item_include handler ^cgi-script$
  mod_gzip_item_include mime ^text/.*
  mod_gzip_item_include mime ^application/x-javascript.*
  mod_gzip_item_exclude mime ^image/.*
  mod_gzip_item_exclude rspheader ^Content-Encoding:.*gzip.*
</ifModule>



# Turn on URL rewriting and set the base
RewriteEngine on
#RewriteBase /

#  Redirect non-www to the www domain
RewriteCond %{HTTP_HOST} ^www.megamanpoweredup.net$ [NC]
RewriteRule ^(.*)$ http://megamanpoweredup.net/$1 [R=301,L]

#  Redirect and rpg2k11 traffic to the non-version
RewriteCond %{HTTP_HOST} ^rpg.megamanpoweredup.net$ [NC]
RewriteRule ^rpg2k11/(.*)$ http://rpg.megamanpoweredup.net/$1 [R=301,L]

# Redirect the XML requests to their dynamic counterparts
RewriteRule ^mmrpg-info\.xml$ external/mmrpg-info.php [L]
RewriteRule ^mmrpg-ranking\.xml$ external/mmrpg-ranking.php [L]
RewriteRule ^sitemap\.xml$ sitemap.php [L]
RewriteRule ^styles/master\.css$ styles/master.php [L]

# Redirect the non-existant pages to better places
RewriteRule ^home/?$ / [R,L]
RewriteRule ^updates/?$ /community/news/ [R,L]
RewriteRule ^www\.website\.com$ / [R,L]

RewriteRule ^images/gallery/(legacy|milestones|misc|starforce)/(.*)?$ /images/gallery/other/$1/$2 [R,L]
RewriteRule ^images/(players|robots|abilities|items|fields|type)(_shadows)?/(.*)?$ /images/sprites/$1$2/$3 [R,L]

RewriteRule ^images/sprites/robots/_disco/(.*)?$ /images/sprites/robots/disco_legacy/$1 [R,L]
RewriteRule ^images/sprites/fields/elec-field/(.*)?$ /images/sprites/fields/electrical-tower/$1 [R,L]
RewriteRule ^images/sprites/fields/ice-field/(.*)?$ /images/sprites/fields/arctic-jungle/$1 [R,L]
RewriteRule ^images/sprites/fields/guts-field/(.*)?$ /images/sprites/fields/mountain-mines/$1 [R,L]
RewriteRule ^images/sprites/robots/([a-z]+)man/(.*)?$ /images/sprites/robots/$1-man/$2 [R,L]

# Define the rewrite conditions
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule (.*) - [S=53]

# Define the redirect rules for the ability image asset quick-paths (8)
RewriteRule ^i/a/([-_a-z0-9]+)/il([0-9]+).png(.*)?$ images/sprites/abilities/$1/icon_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/a/([-_a-z0-9]+)/ir([0-9]+).png(.*)?$ images/sprites/abilities/$1/icon_right_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/as/([-_a-z0-9]+)/il([0-9]+).png(.*)?$ images/abilities_shadows/$1/icon_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/as/([-_a-z0-9]+)/ir([0-9]+).png(.*)?$ images/abilities_shadows/$1/icon_right_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/a/([-_a-z0-9]+)/sl([0-9]+).png(.*)?$ images/sprites/abilities/$1/sprite_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/a/([-_a-z0-9]+)/sr([0-9]+).png(.*)?$ images/sprites/abilities/$1/sprite_right_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/as/([-_a-z0-9]+)/sl([0-9]+).png(.*)?$ images/abilities_shadows/$1/sprite_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/as/([-_a-z0-9]+)/sr([0-9]+).png(.*)?$ images/abilities_shadows/$1/sprite_right_$2x$2.png?$3 [QSA,L]

# Define the redirect rules for the item image asset quick-paths (8)
RewriteRule ^i/i/([-_a-z0-9]+)/il([0-9]+).png(.*)?$ images/sprites/items/$1/icon_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/i/([-_a-z0-9]+)/ir([0-9]+).png(.*)?$ images/sprites/items/$1/icon_right_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/is/([-_a-z0-9]+)/il([0-9]+).png(.*)?$ images/items_shadows/$1/icon_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/is/([-_a-z0-9]+)/ir([0-9]+).png(.*)?$ images/items_shadows/$1/icon_right_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/i/([-_a-z0-9]+)/sl([0-9]+).png(.*)?$ images/sprites/items/$1/sprite_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/i/([-_a-z0-9]+)/sr([0-9]+).png(.*)?$ images/sprites/items/$1/sprite_right_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/is/([-_a-z0-9]+)/sl([0-9]+).png(.*)?$ images/items_shadows/$1/sprite_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/is/([-_a-z0-9]+)/sr([0-9]+).png(.*)?$ images/items_shadows/$1/sprite_right_$2x$2.png?$3 [QSA,L]

# Define the redirect rules for the player image asset quick-paths (8)
RewriteRule ^i/p/([-_a-z0-9]+)/ml([0-9]+).png(.*)?$ images/sprites/players/$1/mug_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/p/([-_a-z0-9]+)/mr([0-9]+).png(.*)?$ images/sprites/players/$1/mug_right_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/ps/([-_a-z0-9]+)/ml([0-9]+).png(.*)?$ images/players_shadows/$1/mug_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/ps/([-_a-z0-9]+)/mr([0-9]+).png(.*)?$ images/players_shadows/$1/mug_right_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/p/([-_a-z0-9]+)/sl([0-9]+).png(.*)?$ images/sprites/players/$1/sprite_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/p/([-_a-z0-9]+)/sr([0-9]+).png(.*)?$ images/sprites/players/$1/sprite_right_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/ps/([-_a-z0-9]+)/sl([0-9]+).png(.*)?$ images/players_shadows/$1/sprite_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/ps/([-_a-z0-9]+)/sr([0-9]+).png(.*)?$ images/players_shadows/$1/sprite_right_$2x$2.png?$3 [QSA,L]

# Define the redirect rules for the robot image asset quick-paths (8)
RewriteRule ^i/r/([-_a-z0-9]+)/ml([0-9]+).png(.*)?$ images/sprites/robots/$1/mug_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/r/([-_a-z0-9]+)/mr([0-9]+).png(.*)?$ images/sprites/robots/$1/mug_right_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/rs/([-_a-z0-9]+)/ml([0-9]+).png(.*)?$ images/robots_shadows/$1/mug_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/rs/([-_a-z0-9]+)/mr([0-9]+).png(.*)?$ images/robots_shadows/$1/mug_right_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/r/([-_a-z0-9]+)/sl([0-9]+).png(.*)?$ images/sprites/robots/$1/sprite_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/r/([-_a-z0-9]+)/sr([0-9]+).png(.*)?$ images/sprites/robots/$1/sprite_right_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/rs/([-_a-z0-9]+)/sl([0-9]+).png(.*)?$ images/robots_shadows/$1/sprite_left_$2x$2.png?$3 [QSA,L]
RewriteRule ^i/rs/([-_a-z0-9]+)/sr([0-9]+).png(.*)?$ images/robots_shadows/$1/sprite_right_$2x$2.png?$3 [QSA,L]

# Define the redirect rules for the field image asset quick-paths (5)
RewriteRule ^i/f/([-_a-z0-9]+)/bfa.png(.*)?$ images/sprites/fields/$1/battle-field_avatar.png?$3 [QSA,L]
RewriteRule ^i/f/([-_a-z0-9]+)/bfbb.gif(.*)?$ images/sprites/fields/$1/battle-field_background_base.gif?$3 [QSA,L]
RewriteRule ^i/f/([-_a-z0-9]+)/bfbb.png(.*)?$ images/sprites/fields/$1/battle-field_background_base.png?$3 [QSA,L]
RewriteRule ^i/f/([-_a-z0-9]+)/bffb.png(.*)?$ images/sprites/fields/$1/battle-field_foreground_base.png?$3 [QSA,L]
RewriteRule ^i/f/([-_a-z0-9]+)/bfp.png(.*)?$ images/sprites/fields/$1/battle-field_preview.png?$3 [QSA,L]

# Define the redirect rules for specific pages (16)
RewriteRule ^community/([-_a-z0-9]+)/([0-9]+)/([-_a-z0-9]+)/?([0-9]+)/?$ index.php?page=community&cat=$1&id=$2&token=$3&num=$4 [QSA,L]
RewriteRule ^community/([-_a-z0-9]+)/([0-9]+)/([-_a-z0-9]+)/?([0-9]+)/(.*)$ index.php?page=community&cat=$1&id=$2&token=$3&num=$4&$5 [QSA,L]
RewriteRule ^community/([-_a-z0-9]+)/([0-9]+)/([-_a-z0-9]+)/([-_a-z0-9]+)/\??(.*)$ index.php?page=community&cat=$1&id=$2&token=$3&target=$4&$5 [QSA,L]
RewriteRule ^community/([-_a-z0-9]+)/([0-9]+)/([-_a-z0-9]+)/?\??(.*)$ index.php?page=community&cat=$1&id=$2&token=$3&$4 [QSA,L]
RewriteRule ^community/([-_a-z0-9]+)/([-_a-z0-9]+)/?\??(.*)$ index.php?page=community&cat=$1&sub=$2&$3 [QSA,L]
RewriteRule ^community/([-_a-z0-9]+)/\??(.*)$ index.php?page=community&cat=$1&$2 [QSA,L]

RewriteRule ^file/game/([-_a-z0-9]+)/?\??(.*)$ index.php?page=file&sub=game&token=$1 [QSA,L]

RewriteRule ^leaderboard/([0-9]+)/\??(.*)$ index.php?page=leaderboard&num=$1&$2 [QSA,L]
RewriteRule ^leaderboard/([-_a-z0-9]+)/([-_a-z0-9]+)/?\??(.*)$ index.php?page=leaderboard&sub=$1&token=$2 [QSA,L]
RewriteRule ^leaderboard/([-_a-z0-9]+)/\??(.*)$ index.php?page=leaderboard&sub=$1&$2 [QSA,L]

RewriteRule ^database/(players|abilities|robots|mechas|bosses|types|fields|items)/([-_a-z0-9]+)/?\??(.*)$ index.php?page=database&sub=$1&token=$2 [QSA,L]
RewriteRule ^database/(players|abilities|robots|mechas|bosses|types|fields|items)/\??(.*)$ index.php?page=database&sub=$1&$2 [QSA,L]

RewriteRule ^(home|about|gallery|community|leaderboard|database|prototype|credits|contact|file|admin)/([0-9]+)/?\??(.*)$ index.php?page=$1&num=$2&$3 [L]
RewriteRule ^(home|about|gallery|community|leaderboard|database|prototype|credits|contact|file|admin)/([-_a-z0-9]+)/([0-9]+)/?\??(.*)$ index.php?page=$1&sub=$2&num=$3&$4 [L]
RewriteRule ^(home|about|gallery|community|leaderboard|database|prototype|credits|contact|file|admin)/([-_a-z0-9]+)/?(.*)?$ index.php?page=$1&sub=$2&$3 [L]
RewriteRule ^(home|about|gallery|community|leaderboard|database|prototype|credits|contact|file|error|admin)/?\??(.*)$ index.php?page=$1&$2 [L]